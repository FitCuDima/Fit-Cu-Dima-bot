import telebot
from telebot import types
import os

BOT_TOKEN = os.getenv("BOT_TOKEN")
bot = telebot.TeleBot(BOT_TOKEN)

user_data = {}

# ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /start â†’ Ğ²Ñ‹Ğ±Ğ¾Ñ€ ÑĞ·Ñ‹ĞºĞ°
@bot.message_handler(commands=['start'])
def start(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add("RomÃ¢nÄƒ ğŸ‡·ğŸ‡´", "English ğŸ‡¬ğŸ‡§", "Ğ ÑƒÑÑĞºĞ¸Ğ¹ ğŸ‡·ğŸ‡º")
    bot.send_message(message.chat.id, "Alege limba / Choose your language / Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ·Ñ‹Ğº:", reply_markup=markup)

# Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ·Ñ‹ĞºĞ°
@bot.message_handler(func=lambda msg: msg.text in ["RomÃ¢nÄƒ ğŸ‡·ğŸ‡´", "English ğŸ‡¬ğŸ‡§", "Ğ ÑƒÑÑĞºĞ¸Ğ¹ ğŸ‡·ğŸ‡º"])
def choose_language(message):
    lang = message.text[:2]
    chat_id = message.chat.id
    user_data[chat_id] = {"lang": lang}

    if lang == "Ro":
        bot.send_message(chat_id, "Care este obiectivul tÄƒu?", reply_markup=goals_ro())
    elif lang == "En":
        bot.send_message(chat_id, "What is your fitness goal?", reply_markup=goals_en())
    else:
        bot.send_message(chat_id, "ĞšĞ°ĞºĞ°Ñ Ñƒ Ñ‚ĞµĞ±Ñ Ñ†ĞµĞ»ÑŒ?", reply_markup=goals_ru())

# ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Ñ†ĞµĞ»ĞµĞ¹
def goals_ro():
    m = types.ReplyKeyboardMarkup(resize_keyboard=True)
    m.add("Vreau sÄƒ slÄƒbesc ğŸ”¥", "Vreau sÄƒ mÄƒ tonifiez ğŸ’ƒ", "Vreau masÄƒ muscularÄƒ ğŸ†", "Vreau sÄƒ merg la salÄƒ ğŸ‹ï¸")
    return m

def goals_en():
    m = types.ReplyKeyboardMarkup(resize_keyboard=True)
    m.add("I want to lose weight ğŸ”¥", "I want to tone ğŸ’ƒ", "I want muscle mass ğŸ†", "I go to the gym ğŸ‹ï¸")
    return m

def goals_ru():
    m = types.ReplyKeyboardMarkup(resize_keyboard=True)
    m.add("Ğ¥Ğ¾Ñ‡Ñƒ Ğ¿Ğ¾Ñ…ÑƒĞ´ĞµÑ‚ÑŒ ğŸ”¥", "Ğ¥Ğ¾Ñ‡Ñƒ Ğ¿Ğ¾Ğ´Ñ‚ÑĞ½ÑƒÑ‚ÑŒÑÑ ğŸ’ƒ", "Ğ¥Ğ¾Ñ‡Ñƒ Ğ½Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¼Ğ°ÑÑÑƒ ğŸ†", "Ğ¥Ğ¾Ğ¶Ñƒ Ğ² Ğ·Ğ°Ğ» ğŸ‹ï¸")
    return m

# Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ñ†ĞµĞ»ÑŒ Ğ¸ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ Ğº Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚Ñƒ
@bot.message_handler(func=lambda msg: any(x in msg.text for x in ["Vreau", "I want", "Ğ¥Ğ¾Ñ‡Ñƒ"]))
def handle_goal(message):
    chat_id = message.chat.id
    user_data[chat_id]["goal"] = message.text
    ask_age(chat_id)

# Ğ¡Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµĞ¼ Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚
def ask_age(chat_id):
    lang = user_data[chat_id]["lang"]
    txt = {
        "Ro": "Ce vÃ¢rstÄƒ ai?",
        "En": "How old are you?",
        "Ru": "Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚ĞµĞ±Ğµ Ğ»ĞµÑ‚?"
    }
    bot.send_message(chat_id, txt[lang])

@bot.message_handler(func=lambda msg: msg.text.isdigit() and len(msg.text) < 3)
def save_age(message):
    chat_id = message.chat.id
    user_data[chat_id]["age"] = int(message.text)
    ask_height(chat_id)

def ask_height(chat_id):
    txt = {
        "Ro": "Ce Ã®nÄƒlÈ›ime ai? (Ã®n cm)",
        "En": "What is your height? (in cm)",
        "Ru": "ĞšĞ°ĞºĞ¾Ğ¹ Ñƒ Ñ‚ĞµĞ±Ñ Ñ€Ğ¾ÑÑ‚? (Ğ² ÑĞ¼)"
    }
    bot.send_message(chat_id, txt[user_data[chat_id]["lang"]])

@bot.message_handler(func=lambda msg: msg.text.isdigit() and 100 <= int(msg.text) <= 250)
def save_height(message):
    chat_id = message.chat.id
    user_data[chat_id]["height"] = int(message.text)
    ask_weight(chat_id)

def ask_weight(chat_id):
    txt = {
        "Ro": "CÃ¢t cÃ¢ntÄƒreÈ™ti? (kg)",
        "En": "What is your weight? (kg)",
        "Ru": "Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ñ‹ Ğ²ĞµÑĞ¸ÑˆÑŒ? (Ğ² ĞºĞ³)"
    }
    bot.send_message(chat_id, txt[user_data[chat_id]["lang"]])

@bot.message_handler(func=lambda msg: msg.text.isdigit() and 30 <= int(msg.text) <= 200)
def save_weight(message):
    chat_id = message.chat.id
    user_data[chat_id]["weight"] = int(message.text)
    ask_gender(chat_id)

def ask_gender(chat_id):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add("Masculin / Male / ĞœÑƒĞ¶ÑĞºĞ¾Ğ¹", "Feminin / Female / Ğ–ĞµĞ½ÑĞºĞ¸Ğ¹")
    bot.send_message(chat_id, "Sex / Gender / ĞŸĞ¾Ğ»:", reply_markup=markup)

@bot.message_handler(func=lambda msg: any(x in msg.text for x in ["Masculin", "Male", "Ğ–ĞµĞ½", "Feminin"]))
def save_gender(message):
    chat_id = message.chat.id
    user_data[chat_id]["gender"] = message.text
    ask_level(chat_id)

def ask_level(chat_id):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add("ÃncepÄƒtor / Beginner", "Intermediar / Intermediate", "Avansat / Advanced")
    bot.send_message(chat_id, "Nivelul tÄƒu de experienÈ›Äƒ / Your fitness level / Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ¸:", reply_markup=markup)

@bot.message_handler(func=lambda msg: any(x in msg.text for x in ["ÃncepÄƒtor", "Beginner", "Intermediar", "Avansat", "Intermediate", "Advanced"]))
def save_level(message):
    chat_id = message.chat.id
    user_data[chat_id]["level"] = message.text
    ask_plan_length(chat_id)

def ask_plan_length(chat_id):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add("1 antrenament", "3 antrenamente", "10 antrenamente")
    bot.send_message(chat_id, "Pentru cÃ¢te antrenamente vrei planul? / How many workouts do you want? / Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ñ‚ĞµĞ±Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾?", reply_markup=markup)

@bot.message_handler(func=lambda msg: any(x in msg.text for x in ["antrenament", "Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²", "workout"]))
def generate_plan(message):
    chat_id = message.chat.id
    user_data[chat_id]["plan_length"] = message.text

    # â³ Ğ—Ğ´ĞµÑÑŒ Ğ¿Ğ¾Ğ·Ğ¶Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ğ¼ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ»Ğ°Ğ½Ğ° Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹
    bot.send_message(chat_id, "ğŸ“¦ Planul tÄƒu este Ã®n curs de generare...\nğŸ• Te rog sÄƒ aÈ™tepÈ›i cÃ¢teva secunde.")
    bot.send_message(chat_id, "âš ï¸ Antrenamentele vor fi disponibile Ã®n curÃ¢nd pe baza datelor tale. MulÈ›umim!")

# Ğ¡Ñ‚Ğ°Ñ€Ñ‚ÑƒĞµĞ¼ Ğ±Ğ¾Ñ‚Ğ°
bot.polling(none_stop=True)